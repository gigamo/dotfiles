#!/bin/zsh

case $TERM in
    *xterm*|rxvt|rxvt-unicode|rxvt-256color|(dt|k|E)term)
        precmd () { print -Pn "\e]0;$TERM - (%L) [%n@%M]%# [%~]\a" } 
        preexec () { print -Pn "\e]0;$TERM - (%L) [%n@%M]%# [%~] ($1)\a" }
    ;;
    screen)
        precmd () { 
            print -Pn "\e]83;title \"$1\"\a" 
            print -Pn "\e]0;$TERM - (%L) [%n@%M]%# [%~]\a" 
        }
        preexec () { 
            print -Pn "\e]83;title \"$1\"\a" 
            print -Pn "\e]0;$TERM - (%L) [%n@%M]%# [%~] ($1)\a" 
        }
    ;; 
esac

setprompt () {
    autoload -U colors zsh/terminfo
    colors
    setopt prompt_subst

    if [[ `whoami` == root ]]; then
        export PS1="$(print '%{\e[1;31m%}[R] %{\e[0;33m%}[%*] %{\e[0;31m%}[%~]%{\e[0;31m%} %#%{\e[0m%} ')"
    else
        export PS1="$(print '%{\e[0;34m%}[%*] %{\e[0;33m%}[%~]%{\e[0;31m%} %#%{\e[0m%} ')"
        if [[ `stty speed` == 115200 ]]; then
            export LC_ALL=en_US.ISO8859-1
        else
            export LC_ALL=en_US.UTF-8
        fi
    fi
}

setprompt
